<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Chatterbox – Glen Cooney</title> <meta name="description" content="Welcome to my official portfolio site"> <meta name="keywords" content="Bloc, Frontend, Angular"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://transplanar.github.io/portfolio//assets/img/meface_no-border.png"> <meta name="twitter:title" content="Chatterbox"> <meta name="twitter:description" content="A realtime chat application"> <meta name="twitter:site" content="@transplanar"> <meta name="twitter:creator" content="@transplanar"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Chatterbox"> <meta property="og:description" content="A realtime chat application"> <meta property="og:url" content="https://transplanar.github.io/portfolio//Chatterbox/"> <meta property="og:site_name" content="Glen Cooney"> <meta property="og:image" content="https://transplanar.github.io/portfolio//assets/img/meface_no-border.png"> <link rel="canonical" href="https://transplanar.github.io/portfolio//Chatterbox/"> <link href="https://transplanar.github.io/portfolio//feed.xml" type="application/atom+xml" rel="alternate" title="Glen Cooney Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://transplanar.github.io/portfolio//assets/css/main.css"> <!-- JS --> <script src="https://transplanar.github.io/portfolio//assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://transplanar.github.io/portfolio//assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://transplanar.github.io/portfolio//assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://transplanar.github.io/portfolio//assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://transplanar.github.io/portfolio//assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://transplanar.github.io/portfolio//favicon.png"> <link rel="shortcut icon" href="https://transplanar.github.io/portfolio//favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(https://transplanar.github.io/portfolio//assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://transplanar.github.io/portfolio//">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://transplanar.github.io/portfolio//assets/img/meface_no-border.png" alt="Glen Cooney photo" class="author-photo"> <h4>Glen Cooney</h4> <p>Welcome to my official portfolio site</p> </li> <li><a href="https://transplanar.github.io/portfolio//about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:glen@glencooney.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/transplanar" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/glencooney" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/transplanar" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://stackoverflow.com/users/5031910/glen-cooney" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-stack-overflow"></i> StackOverflow</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://transplanar.github.io/portfolio//posts/">All Posts</a></li> <li><a href="https://transplanar.github.io/portfolio//tags/">All Tags</a></li> </ul> </li> <li><a href="https://transplanar.github.io/portfolio//projects/">Projects</a></li> <li><a href="https://transplanar.github.io/portfolio//contact/">Contact</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Chatterbox</h1> <h4>24 Jul 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~3 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://transplanar.github.io/portfolio//projects/"> <i class="fa fa-chevron-left" style="font-size: 1.5rem"></i> </a> <!-- REVIEW FIXME messed up display of heroku icon --> <span> <div class="social-btn"> <a class="fa fa-fw fa-globe" style="font-size: 1.5rem" href="https://chatterbox-app-demo.herokuapp.com/" title="View on Heroku"></a> </div>
<div class="social-btn"> <a style="font-size: 1.5rem" class="fa fa-fw fa-github" href="https://github.com/transplanar/Chatterbox" title="View on Github"></a> </div> </span> </div> <h1 id="the-project">The Project</h1> <p><em>Chatterbox is a chatroom application that updates in realtime through the use of Angular and Firebase.</em></p> <h3 id="tools">Tools</h3> <p><a href="https://www.javascript.com/">Javascript</a>, <a href="https://angularjs.org/">Angular</a>, <a href="https://github.com/angular-ui/ui-router">UI-Router</a>, <a href="https://jquery.com/">jQuery</a>, <a href="https://www.firebase.google.com/">Firebase</a>, <a href="https://github.com/firebase/angularfire">AngularFire</a>, <a href="http://gruntjs.com/">Grunt</a>, <a href="https://docs.angularjs.org/api/ngCookies">ngCookies</a>, <a href="http://getbootstrap.com/">Bootstrap</a>, <a href="http://brackets.io/">Brackets</a>, <a href="http://www.ubuntu.com/">Ubuntu</a></p> <h1 id="the-app">The App</h1> <p><em>Upon loading the app for the first time, the user is prompted to enter a username. From there, they may click to enter any of the chatrooms listed in the left navbar to see messages for that room. Upon closing and/or reloading the page, cookies ensure the user remains logged in<sup>1</sup> as their chosen username.</em></p> <h1 id="process">Process</h1> <p><em>The first task was to set up my Firebase database and associated service for facilitating CRUD operations. Using my <code class="highlighter-rouge">RoomSrv</code> service, I was able to push new rooms to the database, as well as pull down an array of all available Rooms.</em></p> <p><em>To allow users to create new chat rooms, I created a button to trigger a modal input box to appear, allowing users to name and create new chat rooms. This was accomplished using UI Bootstrap’s <code class="highlighter-rouge">$uibModal</code> service.</em></p> <p><em>Upon receiving user input, an <code class="highlighter-rouge">$emit</code> and corresponding <code class="highlighter-rouge">$on</code> function are used to facilitate communication between the <code class="highlighter-rouge">ModalCtrl</code> and <code class="highlighter-rouge">RoomCtrl</code> Controllers.</em></p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ModalCtrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$uibModal</span><span class="p">){</span>
  <span class="p">...</span>

  <span class="nx">modalInstance</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">roomName</span><span class="p">){</span>
      <span class="nx">$scope</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">'createNewRoom'</span><span class="p">,</span> <span class="nx">roomName</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">RoomCtrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">RoomSrv</span><span class="p">,</span> <span class="nx">$cookies</span><span class="p">,</span> <span class="nx">$window</span><span class="p">){</span>
  <span class="p">...</span>

  <span class="nx">$scope</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="s1">'createNewRoom'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">args</span><span class="p">){</span>
      <span class="nx">$scope</span><span class="p">.</span><span class="nx">addRoom</span><span class="p">({</span><span class="na">name</span><span class="p">:</span> <span class="nx">args</span><span class="p">});</span>
    <span class="p">});</span>
    <span class="p">...</span>
  <span class="p">};</span></code></pre></figure> <p><em>The next step was to allow messages to be posted in chat rooms. Upon creation, each message object was set up to be associated with the currently selected room via its <code class="highlighter-rouge">$id</code> autogenerated by Firebase.</em></p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">function</span> <span class="nx">MessageCtrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">MessageSrv</span><span class="p">,</span> <span class="nx">$cookies</span><span class="p">){</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">send</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">messageContent</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">){</span>
        <span class="nx">MessageSrv</span><span class="p">.</span><span class="nx">addMessage</span><span class="p">(</span>
          <span class="p">{</span>
            <span class="na">content</span><span class="p">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageContent</span><span class="p">,</span>
            <span class="na">roomID</span><span class="p">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedRoom</span><span class="p">.</span><span class="nx">$id</span><span class="p">,</span>
            <span class="na">sentAt</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span>
            <span class="na">username</span><span class="p">:</span> <span class="nx">$cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'currentUser'</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">);</span>

        <span class="nx">$scope</span><span class="p">.</span><span class="nx">messageContent</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">angular</span>
    <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'chatterBox'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MessageCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'MessageSrv'</span><span class="p">,</span> <span class="s1">'$cookies'</span><span class="p">,</span> <span class="nx">MessageCtrl</span><span class="p">]);</span>
<span class="p">})();</span></code></pre></figure> <p><em>Retrieving the messages to render to the view involves some unorthdox syntax, which was initially confusing:</em></p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">RoomSrv</span><span class="p">.</span><span class="nx">getMessages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">$firebaseArray</span><span class="p">(</span><span class="nx">firebaseRef</span><span class="p">.</span><span class="nx">child</span><span class="p">(</span><span class="s1">'messages'</span><span class="p">)</span>
                                   <span class="p">.</span><span class="nx">orderByChild</span><span class="p">(</span><span class="s1">'roomID'</span><span class="p">)</span>
                                   <span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
<span class="p">}</span></code></pre></figure> <p><em>Understanding this statement involves looking at the return types of each function. <code class="highlighter-rouge">.child()</code> returns a Firebase reference to the object containing all messages. <code class="highlighter-rouge">orderByChild()</code> returns a <code class="highlighter-rouge">Query</code> with all messages ordered by <code class="highlighter-rouge">roomID</code>. Finally <code class="highlighter-rouge">equalTo()</code> filters the Query down further to only those messages with a matching <code class="highlighter-rouge">roomID</code>. Finally <code class="highlighter-rouge">$firebaseArray()</code> converts the final query into an array to be rendered to the View.```</em></p> <p><em>What is peculiar is that the 2nd statement seems to both reorder the array <sup>2</sup> of results</em> <strong>and</strong> <em>passes a new array, with <code class="highlighter-rouge">equalTo()</code> receiving the key to compare <code class="highlighter-rouge">id</code> against. I can only assume that this was coded this way for some purpose such as optimization, but I would think retrieving queries using key/value pairs would make more sense:</em></p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">var</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">firebaseRef</span><span class="p">.</span><span class="nx">child</span><span class="p">(</span><span class="s1">'messages'</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">$firebaseArray</span><span class="p">(</span><span class="nx">ref</span><span class="p">[</span><span class="nx">roomID</span><span class="p">][</span><span class="nx">id</span><span class="p">]);</span></code></pre></figure> <p><em>Nonetheless, with the display of messages and rooms out of the way, the next step was to set up Users. Upon loading the page for the first time, users are greeted with a Modal prompt asking for a username. This username is stored in a cookie using the <code class="highlighter-rouge">ngCookies</code> service. To make this step manditory, the code the <code class="highlighter-rouge">preventDefault()</code> function is used to prevent the Modal from being dismissed the the input field is empty.</em></p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$scope</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="s1">'modal.closing'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">reason</span><span class="p">,</span> <span class="nx">closed</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">userName</span> <span class="o">===</span> <span class="s1">''</span><span class="p">){</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre></figure> <p><em>Finally, I added functionality to <code class="highlighter-rouge">MessageCtrl</code> to allow users to post new messages into chat rooms associated with their username.</em></p> <h1 id="outcome">Outcome</h1> <p><em>This was a fairly straightforward project, and for me gave me a taste having a Frontend interacting with a non-Rails backend. Tripping up on the terminology for retrieving a message was a bit confusing, but appears to be relatively common with web development, as I have discovered. Given the diversity of toolsets and the “hacks” required in order to optimize functionality for a live web app, I have come to expect some things to initially defy conventional comprehension.</em></p> <h1 id="annotations">Annotations</h1> <blockquote> <p><sup>1</sup> <em>Chatterbox uses only a rudimentary user system, not a complex system of authentication. This was done to limit the scope of the project to only its most valuable features.</em></p> </blockquote> <blockquote> <p><sup>2</sup> <em>Not a true Array, of course, but an object behaving as one in this context.</em></p> </blockquote> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://transplanar.github.io/portfolio//tags/#Bloc" title="Pages tagged Bloc" class="tag"><span class="term">Bloc</span></a><a href="https://transplanar.github.io/portfolio//tags/#Frontend" title="Pages tagged Frontend" class="tag"><span class="term">Frontend</span></a><a href="https://transplanar.github.io/portfolio//tags/#Angular" title="Pages tagged Angular" class="tag"><span class="term">Angular</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://transplanar.github.io/portfolio//Chatterbox/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=https://transplanar.github.io/portfolio//Chatterbox/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://transplanar.github.io/portfolio//Chatterbox/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="https://transplanar.github.io/portfolio//assets/js/jquery-1.12.0.min.js"></script> <script src="https://transplanar.github.io/portfolio//assets/js/jquery.dlmenu.min.js"></script> <script src="https://transplanar.github.io/portfolio//assets/js/jquery.goup.min.js"></script> <script src="https://transplanar.github.io/portfolio//assets/js/jquery.magnific-popup.min.js"></script> <script src="https://transplanar.github.io/portfolio//assets/js/jquery.fitvid.min.js"></script> <script src="https://transplanar.github.io/portfolio//assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-81619796-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
